<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
    <head th:replace="partials/head :: head('View Doohickeys')">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
        <link rel="stylesheet" href="/css/style.css"/>
    </head>
    <body>


        <nav th:replace="partials/navbar :: nav"></nav>
        <main class="container-fluid w-75 pt-3">


            <nav th:replace="partials/pagination :: pageList"></nav>


            <th:block th:each="doohickey : ${page}">
                <div class="card p-1 my-2" style="cursor:pointer;">
                    <!--/* Thymeleaf has several built-in string utility functions like capitalizeWords */-->
                    <div class="card-body" th:onclick="${'location=''/doohickeys/'+doohickey.id+''''}">
                        <h3 th:text="${#strings.capitalizeWords(doohickey.title)}">Doohickey</h3>
                        <p th:text="${doohickey.description}">Lorem ipsum dolor sit amet, consectetur adipisicing elit. A accusamus accusantium alias aliquid architecto eligendi, excepturi explicabo libero maiores non numquam quae recusandae, sapiente suscipit, unde vero voluptatibus! Officiis, temporibus.</p>
                        <small class="text-muted" th:text="${'-' + doohickey.author.username}">Username</small>
                        <a sec:authorize="isAuthenticated()" th:if="${#authentication.principal.id} == ${doohickey.author.id}" th:href="@{'/doohickeys/'+${doohickey.id}+'/edit'}">Edit</a>
                    </div>
                    <div class="card-footer">
                        <button th:if="${user}" class="favButton" th:attr="data-id=${doohickey.id}"><i th:class="${(doohickey.usersFavoritedContains(user.id) ? 'fas' : 'far')+' fa-heart'}"></i></button>

                        <th:block th:each="tag : ${doohickey.tags}">
                            <a href="" th:text="${tag.name}"></a>
                        </th:block>
                    </div>
                </div>
            </th:block>
        </main>

        <th:block th:include="partials/scripts :: scripts" />
        <script>
            $(".favButton").click(function(e){
                var button = $(this);
                var id = button.attr("data-id");
                console.log(button);
                $.get("/doohickeys/"+id+"/favorite",function(data){
                    console.log(data);
                    if(data == "Favorited") {
                        console.log(data);
                        button.find("i").removeClass("far");
                        button.find("i").addClass("fas");
                    }else if (data == "UnFavorited"){
                        console.log(data);
                        button.find("i").addClass("far");
                        button.find("i").removeClass("fas");
                    }else {
                        document.location = "/login";
                    }
                });
            });
        </script>
    </body>
</html>